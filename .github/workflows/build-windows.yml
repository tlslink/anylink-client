name: Build AnyLink Client with MinGW

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: 1. 检出代码和子模块
      uses: actions/checkout@v4
      with:
        submodules: recursive
        
    - name: 2. 安装Qt (MinGW版)
      uses: jurplel/install-qt-action@v3
      with:
        version: '5.15.2'
        arch: 'win64_mingw81'
        
    - name: 3. 检查环境
      shell: cmd
      run: |
        echo 环境检查...
        where g++ 2>nul || echo "g++未找到"
        where mingw32-make 2>nul || echo "mingw32-make未找到"
        qmake --version
        
    - name: 4. 配置项目
      shell: cmd
      run: |
        echo 配置项目...
        qmake anylink.pro -spec win32-g++ CONFIG+=release
        
    - name: 5. 编译
      shell: cmd
      run: |
        echo 开始编译...
        mingw32-make
        
    - name: 6. 检查结果
      shell: cmd
      run: |
        if exist release\*.exe (
          echo ✅ MinGW编译成功！
          dir release\*.exe
        ) else (
          echo ❌ 编译失败
          dir
          exit 1
        )
